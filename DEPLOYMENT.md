# 🚀 部署指南

本文档详细说明如何将课程提醒系统部署到 GitHub 并配置自动化运行。

## 📋 部署前准备

### 1. 获取飞书 Webhook URL

#### 方法一：通过飞书群聊机器人
1. 在飞书群聊中点击右上角设置
2. 选择"群机器人" → "添加机器人"
3. 选择"自定义机器人"
4. 设置机器人名称和头像
5. 复制生成的 Webhook URL

#### 方法二：通过飞书开放平台
1. 访问 [飞书开放平台](https://open.feishu.cn/)
2. 创建应用并获取 Webhook URL

### 2. 准备 GitHub 账户
- 确保有 GitHub 账户
- 了解基本的 Git 操作

## 🔧 部署步骤

### 步骤 1：Fork 项目

1. 访问项目仓库
2. 点击右上角 "Fork" 按钮
3. 选择你的 GitHub 账户
4. 等待 Fork 完成

### 步骤 2：配置 GitHub Secrets

1. 进入你 Fork 的仓库
2. 点击 "Settings" 标签页
3. 在左侧菜单选择 "Secrets and variables" → "Actions"
4. 点击 "New repository secret"
5. 添加以下 Secret：

| Name | Value | 说明 |
|------|-------|------|
| `FEISHU_WEBHOOK_URL` | 你的飞书 Webhook URL | 必须以 https://www.feishu.cn/flow/api/trigger-webhook/ 开头 |

**重要提示：**
- Secret 名称必须完全匹配 `FEISHU_WEBHOOK_URL`
- URL 不要包含额外的空格或换行符
- 确保 URL 有效且可访问

### 步骤 3：启用 GitHub Actions

1. 在仓库中点击 "Actions" 标签页
2. 如果看到提示 "Workflows aren't being run on this forked repository"
3. 点击 "I understand my workflows, go ahead and enable them"
4. GitHub Actions 将自动启用

### 步骤 4：验证部署

#### 手动测试
1. 进入 "Actions" 标签页
2. 选择 "课程提醒系统" workflow
3. 点击 "Run workflow"
4. 选择运行模式：
   - `test`：发送测试通知
   - `debug`：显示系统状态（不发送通知）
   - `normal`：正常运行模式

#### 检查测试结果
1. 点击运行的 workflow
2. 查看运行日志
3. 确认飞书群聊收到测试消息

## ⏰ 自动化运行

### 定时任务说明

系统将自动按以下时间运行：

1. **课前提醒检查**：每10分钟检查一次（工作日）
   - UTC 时间：`*/10 * * * 1-5`
   - 北京时间：工作日每10分钟

2. **明日预告**：每晚11点（北京时间）
   - UTC 时间：`0 15 * * *`
   - 北京时间：每天 23:00

### 时区处理

- GitHub Actions 默认使用 UTC 时间
- 系统内部自动转换为北京时间（UTC+8）
- 所有提醒时间基于北京时间计算

## 🔍 监控和维护

### 查看运行日志

1. 进入 "Actions" 标签页
2. 选择最近的运行记录
3. 点击查看详细日志
4. 检查是否有错误或警告

### 常见状态码

- **成功运行**：绿色勾号 ✅
- **运行失败**：红色叉号 ❌
- **运行中**：黄色圆圈 🟡

### 日志分析

#### 正常运行日志示例：
```
🚀 课程提醒系统启动
⏰ 当前时间: 2025/9/25 14:21:16
📅 当前学期周次: 第2周
🔍 检查课前提醒...
✅ 当前时间无需发送课前提醒
🔍 检查明日预告...
✅ 当前时间无需发送明日预告
✅ 课程提醒系统检查完成
```

#### 发送提醒日志示例：
```
📚 发现 1 门即将开始的课程
准备发送课前提醒: 电子材料与器件
飞书通知发送完成，状态码: 200
✅ 课前提醒发送成功: 电子材料与器件
```

## 🛠️ 故障排除

### 问题 1：没有收到提醒

**可能原因：**
- GitHub Actions 未启用
- FEISHU_WEBHOOK_URL 配置错误
- 飞书机器人被移除或禁用

**解决方案：**
1. 检查 Actions 是否正常运行
2. 验证 Secret 配置是否正确
3. 测试 Webhook URL 是否有效
4. 运行手动测试确认功能

### 问题 2：时间不准确

**可能原因：**
- 学期开始时间设置错误
- 时区转换问题

**解决方案：**
1. 检查 `src/course-data.js` 中的 `SEMESTER_START_DATE`
2. 确认当前周次计算是否正确
3. 运行 debug 模式查看详细信息

### 问题 3：Actions 运行失败

**可能原因：**
- 代码语法错误
- 依赖安装失败
- 网络连接问题

**解决方案：**
1. 查看详细错误日志
2. 检查代码是否有语法错误
3. 重新运行 workflow
4. 如果持续失败，提交 Issue

### 问题 4：飞书通知格式异常

**可能原因：**
- 消息内容包含特殊字符
- 飞书 API 格式要求变更

**解决方案：**
1. 检查消息内容是否符合飞书要求
2. 测试不同的消息格式
3. 查看飞书开发文档更新

## 📊 性能监控

### GitHub Actions 使用限制

- **免费账户**：每月 2000 分钟
- **付费账户**：根据计划不同
- **本系统预估使用**：每月约 50-100 分钟

### 优化建议

1. **减少运行频率**：如果不需要频繁检查，可以调整 cron 表达式
2. **条件运行**：在特定条件下才运行（如学期期间）
3. **批量处理**：合并多个通知减少运行次数

## 🔄 更新和维护

### 更新课程信息

1. 编辑 `src/course-data.js` 文件
2. 修改课程数组中的信息
3. 提交更改到 GitHub
4. 系统将自动使用新的课程信息

### 更新提醒时间

1. 修改 `CAMPUS_REMINDER_CONFIG` 配置
2. 调整不同校区的提前提醒时间
3. 测试新的时间设置

### 更新学期时间

1. 修改 `SEMESTER_START_DATE`
2. 设置新学期的开始日期
3. 验证周次计算是否正确

## 📞 技术支持

### 获取帮助

1. **查看文档**：仔细阅读 README.md 和本部署指南
2. **检查日志**：查看 GitHub Actions 运行日志
3. **提交 Issue**：在 GitHub 仓库中提交问题
4. **社区讨论**：参与项目讨论

### 提交 Issue 时请包含

- 详细的问题描述
- 错误日志截图
- 系统环境信息
- 复现步骤

---

**部署成功后，你将拥有一个完全自动化的智能课程提醒系统！** 🎉